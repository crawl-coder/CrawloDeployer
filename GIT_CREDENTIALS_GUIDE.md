# Git 凭证管理使用说明

## 概述

Git 凭证管理系统允许用户为不同的 Git 提供商（如 GitHub、GitLab 等）存储和管理访问凭证。这些凭证可以用于从 Git 仓库克隆项目代码。

## Git 凭证与项目的关系

### 1. 凭证存储
- 用户可以为每个 Git 提供商（GitHub、GitLab 等）存储一个凭证
- 凭证包括用户名和访问令牌（Token）或SSH密钥
- 凭证在数据库中加密存储，确保安全性

### 2. 项目创建时使用凭证
当用户通过 Git 仓库创建项目时：
1. 系统会根据仓库 URL 判断 Git 提供商类型
2. 自动查找用户存储的对应提供商的凭证
3. 使用凭证中的认证信息进行身份验证
4. 克隆仓库到项目目录

### 3. 凭证管理流程

#### 添加 Git 凭证
1. 进入"Git 凭证管理"页面
2. 点击"添加凭证"按钮
3. 选择 Git 提供商（GitHub、GitLab 等）
4. 选择认证方式：
   - **Token/密码认证**：输入用户名和访问令牌
   - **SSH密钥认证**：输入SSH私钥内容和可选的公钥指纹
5. 点击"确定"保存

#### 使用凭证创建项目
1. 在"创建项目"对话框中选择"Git仓库"部署方式
2. 输入 Git 仓库 URL 和分支名
3. 选择认证方式：
   - **Token/密码**：系统会自动使用已存储的对应提供商凭证进行克隆
   - **SSH密钥**：可以直接在项目创建表单中输入SSH私钥，或使用已存储的凭证

#### 凭证安全性
- 访问令牌和SSH私钥在数据库中加密存储
- 传输过程中使用 HTTPS 加密
- 不会在任何前端界面显示完整的敏感信息

## 支持的认证方式

### 1. Token/密码认证
- 适用于HTTP/HTTPS协议的Git仓库
- 需要提供用户名和访问令牌
- 访问令牌在数据库中加密存储

### 2. SSH密钥认证
- 适用于SSH协议的Git仓库
- 需要提供SSH私钥内容（PEM格式）
- 可选提供SSH公钥指纹用于验证
- SSH私钥在数据库中加密存储

## 支持的 Git 提供商

1. **GitHub** - 使用个人访问令牌或SSH密钥
2. **GitLab** - 使用个人访问令牌或SSH密钥
3. **Gitee** - 使用个人访问令牌或SSH密钥
4. **其他** - 支持其他 Git 服务

## SSH密钥使用指南

### 1. 生成SSH密钥对
如果还没有SSH密钥对，可以使用以下命令生成：

```bash
ssh-keygen -t ed25519 -C "your_email@example.com"
```

或者使用RSA算法：

```bash
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
```

### 2. 获取公钥指纹
可以通过以下命令获取SSH公钥指纹：

```bash
ssh-keygen -lf ~/.ssh/id_ed25519.pub
```

或

```bash
ssh-keygen -lf ~/.ssh/id_rsa.pub
```

### 3. 添加SSH公钥到Git提供商
将公钥内容添加到对应的Git提供商账户中：

- **GitHub**: Settings -> SSH and GPG keys -> New SSH key
- **GitLab**: Preferences -> SSH Keys
- **Gitee**: 设置 -> SSH公钥

### 4. 在CrawloDeployer中使用SSH密钥
1. 在"Git凭证管理"中添加SSH密钥凭证，或
2. 在创建项目时直接输入SSH私钥内容

## 最佳实践

### 凭证管理
1. 为每个 Git 提供商只存储一个凭证
2. 定期更新访问令牌
3. 使用具有最小必要权限的令牌
4. 妥善保管SSH私钥文件

### 安全建议
1. 不要在代码中硬编码敏感信息
2. 定期轮换访问令牌
3. 使用强密码保护SSH私钥
4. 限制SSH密钥的使用权限

## 故障排除

### 凭证相关问题
- 确认已正确配置 Git 凭证
- 检查访问令牌是否有效且具有足够权限
- 验证SSH私钥格式是否正确

### 项目创建问题
- 确认已正确配置 Git 凭证
- 检查仓库 URL 格式是否正确
- 验证分支是否存在
- 确认SSH密钥是否具有读取权限